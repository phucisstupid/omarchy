#!/bin/bash
set -euo pipefail

echo -e "\e[32mUpdate Omarchy\e[0m"

# Ensure we have full history before pulling
if git -C "$OMARCHY_PATH" rev-parse --is-shallow-repository >/dev/null 2>&1; then
  if [ "$(git -C "$OMARCHY_PATH" rev-parse --is-shallow-repository)" = "true" ]; then
    echo "Unshallowing repository..."
    git -C "$OMARCHY_PATH" fetch --unshallow --quiet
  fi
fi

git -C "$OMARCHY_PATH" pull --autostash
git -C "$OMARCHY_PATH" diff --check || git -C "$OMARCHY_PATH" reset --merge
